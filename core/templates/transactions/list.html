<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
     <div class="mb-3 text-end">
        {% if request.user.is_authenticated %}
            üë§ {{ request.user.username }}
            <form method="post" action="{% url 'logout' %}" class="d-inline">
            {% csrf_token %}
             <button type="submit" class="btn btn-sm btn-outline-secondary ms-2">–í—ã–π—Ç–∏</button>
            </form>
        {% else %}
            <a href="{% url 'login' %}" class="btn btn-sm btn-outline-primary">–í–æ–π—Ç–∏</a>
        {% endif %}
    </div>
    <h1 class="mb-4">–°–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h1>

    <a href="{% url 'transaction_create' %}" class="btn btn-success mb-3">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é</a>

    <!-- –§–æ—Ä–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-3">
            <label class="form-label">–° –¥–∞—Ç—ã</label>
            <input type="date" name="start_date" class="form-control" value="{{ start_date }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">–ü–æ –¥–∞—Ç—É</label>
            <input type="date" name="end_date" class="form-control" value="{{ end_date }}">
        </div>
        <div class="col-md-3">
            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select name="category" class="form-select">
                <option value="">–í—Å–µ</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if cat.id == selected_category %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label">–ö—Ç–æ –ø–ª–∞—Ç–∏–ª</label>
            <select name="paid_by" class="form-select">
                <option value="">–í—Å–µ</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if user.id == selected_paid_by %}selected{% endif %}>
                        {{ user.username }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-2 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </form>


    <!-- –î–û–•–û–î–´ -->
    <h3 class="mt-5">–î–æ—Ö–æ–¥—ã</h3>
    <table class="table table-bordered table-hover table-striped">
        <thead class="table-success">
        <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–°—É–º–º–∞</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–ü–ª–∞—Ç–∏–ª</th>
            <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        {% for tx in incomes %}
            <tr>
                <td>{{ tx.date }}</td>
                <td>{{ tx.amount }} –≥—Ä–Ω</td>
                <td>{{ tx.category.name }}</td>
                <td>{{ tx.paid_by.username }}</td>
                <td>
                    {% for user in tx.participants.all %}
                        <span class="badge bg-primary">{{ user.username }}</span>
                    {% endfor %}
                </td>
                <td>{{ tx.description }}</td>
                <td>
                    {% if request.user.is_staff %}
                        <a href="{% url 'transaction_update' tx.id %}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
                        <a href="{% url 'transaction_delete' tx.id %}" class="btn btn-sm btn-danger"
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?');">üóëÔ∏è</a>
                    {% endif %}
                </td>

            </tr>
        {% empty %}
            <tr>
                <td colspan="6" class="text-center">–ù–µ—Ç –¥–æ—Ö–æ–¥–æ–≤</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- –†–ê–°–•–û–î–´ -->
    <h3 class="mt-5">–†–∞—Å—Ö–æ–¥—ã</h3>
    <table class="table table-bordered table-hover table-striped">
        <thead class="table-danger">
        <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–°—É–º–º–∞</th>
            <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
            <th>–ü–ª–∞—Ç–∏–ª</th>
            <th>–£—á–∞—Å—Ç–Ω–∏–∫–∏</th>
            <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody>
        {% for tx in expenses %}
            <tr>
                <td>{{ tx.date }}</td>
                <td>{{ tx.amount }} –≥—Ä–Ω</td>
                <td>{{ tx.category.name }}</td>
                <td>{{ tx.paid_by.username }}</td>
                <td>
                    {% for user in tx.participants.all %}
                        <span class="badge bg-primary">{{ user.username }}</span>
                    {% endfor %}
                </td>
                <td>{{ tx.description }}</td>
                               <td>
                    {% if request.user.is_staff %}
                        <a href="{% url 'transaction_update' tx.id %}" class="btn btn-sm btn-warning">‚úèÔ∏è</a>
                        <a href="{% url 'transaction_delete' tx.id %}" class="btn btn-sm btn-danger"
                        onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é?');">üóëÔ∏è</a>
                    {% endif %}
                </td>                
            </tr>
        {% empty %}
            <tr>
                <td colspan="6" class="text-center">–ù–µ—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <!-- –ò—Ç–æ–≥–∏ -->
    <div class="mt-4">
        <h5>–ò—Ç–æ–≥–∏:</h5>
        <ul class="list-group">
            <li class="list-group-item d-flex justify-content-between">
                <span>–û–±—â–∏–π –¥–æ—Ö–æ–¥:</span>
                <strong class="text-success">{{ total_income|floatformat:2 }} –≥—Ä–Ω</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
                <span>–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã:</span>
                <strong class="text-danger">{{ total_expense|floatformat:2 }} –≥—Ä–Ω</strong>
            </li>
            <li class="list-group-item d-flex justify-content-between">
                <span>–ë–∞–ª–∞–Ω—Å:</span>
                <strong class="{% if balance >= 0 %}text-success{% else %}text-danger{% endif %}">
                    {{ balance|floatformat:2 }} –≥—Ä–Ω
                </strong>
            </li>
        </ul>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ —Ä–∞—Å—á—ë—Ç–∞ –¥–æ–ª–≥–æ–≤ -->
    <div class="mt-4 text-center">
        <a href="{% url 'debt_result' %}" class="btn btn-outline-dark btn-lg">
            üí∏ –†–∞—Å—Å—á–∏—Ç–∞—Ç—å, –∫—Ç–æ –∫–æ–º—É –¥–æ–ª–∂–µ–Ω
        </a>
    </div>

</div>
</body>
</html>
